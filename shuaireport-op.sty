\NeedsTeXFormat{LaTeX2e}
\ProvidesExplPackage{shuaireport-op}{2023-11-28}{0.1}
  {Operator macros for shuaireport}

% TODO: options to disable colors
% TODO: batch generate operator commands

\RequirePackage{xkcdcolors, unicode-math}

% https://tex.stackexchange.com/a/17119
\prg_set_conditional:Npnn \__shuairep_op_is_num:n #1 { T }
  {
    \sbox \z@{\@tempcnta=0#1\relax}
    \ifdim\wd0 > \z@ \relax
      \prg_return_false:
    \else:
      \prg_return_true:
    \fi:
  }

\cs_new_protected:Npn \__shuairep_op_aux:n #1
  {
    \IfNoValueF {#1}
      {
        \int_compare:nTF { \clist_count:n {#1} = 1 }
          { \__shuairep_op_is_num:nT {#1} {+}
          \mode_if_math:F {\tl_show:n{no}} #1 }
          { + \clist_use:Nn #1 { } }
      }
  }

\cs_new_eq:NN \op@subscript \__shuairep_op_aux:n

\ExplSyntaxOff
% to enable _ for math subscripts

\NewDocumentCommand\Op{ s m m m t+ o }{
  % #1: whether use hat
  % #2: color
  % #3: operator name
  % #4: main subscript
  % #5: \dagger symbol
  % #6: hopping number, additional subscript
  \textcolor{#2}{
      \IfBooleanF {#1} {\hat} {#3} _ { #4 \op@subscript{#6} }
      \IfBooleanT {#5} { ^{\dagger} }
    }
}

\newcommand{\Opa}{\Op{xkcdLightMaroon}{a}}
\newcommand{\Opb}{\Op{xkcdMarineBlue!90}{b}}
\newcommand{\Opc}{\Op{xkcdBritishRacingGreen!90}{c}}

\newcommand{\Ope}{\Op*{xkcdUmber}{\varepsilon}}

\endinput
%% tests: \[ \Opam \Opam+[1] \Opam[\uparrow] \Opam[2,\uparrow] \]
